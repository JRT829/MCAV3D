<!DOCTYPE html>
<html>
  <head>
    <title>MCAV Public Transport Integration Visualisation</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
 
  </head>
  <body>
    <div id="map"></div><!--Placeholder for map -->
 
  
 
  <script src="{{url_for('static', filename='js/main.js')}}"></script><!--Connecting html with javascript-->
  
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJcC-iTbiurisPUUqn6dd3LVtadL57XEI&callback=initMap"
   ></script><!--Google Maps API access-->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.js"  ></script><!--Socket.IO access -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marker-animate-unobtrusive/0.2.8/vendor/markerAnimate.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marker-animate-unobtrusive/0.2.8/SlidingMarker.min.js"></script>
    <script >
  
      
     
      let socket = io('http://localhost:5000');//Initialising socket.IO server
      const tramicons= 'https://img.icons8.com/cotton/30/000000/tram--v6.png'
      const tramicon= 'https://www.simpleimageresizer.com/_uploads/photos/c8c92c24/tram_64x64.png'
      const busicon= 'https://img.icons8.com/office/16/000000/bus.png'
      const trainicon= 'https://img.icons8.com/emoji/30/000000/train-emoji.png'
      const lightrail='https://e7.pngegg.com/pngimages/722/807/png-clipart-tram-light-rail-in-sydney-transport-for-nsw-lilyfield-travel-miscellaneous-text-thumbnail.png' 
     
      let iconlist=[tramicons,tramicons,trainicon]
      
     
        

      
        let markers=[]//Initialisng markers
        socket.emit('spawn')//Activating API call from ptnsw.py
        socket.once('data',function(data){//From emitting event (spawn) this event (tram) is triggered) 
        
        for(let i=0;i<data.length;i++){
        let markerstemp=[]
        //console.log(coordinates)//Testing if coordinates are present 
        let latitude=data[i][0]//Extracting coordinates
        let longitude=data[i][1]
        let routeid=data[i][2]
        
        
        for(let j=0;j<routeid.length;j++){//Creating all the markers
          let myLatlng=new google.maps.LatLng(latitude[j],longitude[j])
          let infowindow = new google.maps.InfoWindow({
                  content: '<h1 id="firstHeading" class="firstHeading">'+String(routeid[j])+'</h1>'+'<img src='+lightrail+">" ,
                  });
          let marker=new google.maps.Marker({  
            map: map,
            title:j.toString(),    
            position: myLatlng,
            icon:iconlist[i]
              })

            
            marker.addListener("mouseover", () => {
                infowindow.open({
                anchor: marker,
                map,
                });
            });
            marker.addListener('mouseout', function() {
                infowindow.close();
                });
            markerstemp.push(marker) 

            
                
            }
            markers.push(markerstemp)
            
            
          }
          
        }
        )
        function replaceMarkers(markers){
        socket.emit('spawn')//Activating API call from ptnsw.py
        socket.on('data',function(data){//From emitting event (spawn) this event (tram) is triggered) 
        for(let i=0;i<data.length;i++){
        
        //console.log(coordinates)//Testing if coordinates are present 
        let latitude=data[i][0]//Extracting coordinates
        let longitude=data[i][1]
        
        for(let j=0;j<latitude.length;j++){//Creating all the markers
          let myLatlng=new google.maps.LatLng(latitude[j],longitude[j])
          let markertemp=markers[i]
            markertemp[j].setPosition(myLatlng)
            
            }
          
          }
          
        }
        )
        }

        
        setInterval(replaceMarkers,2000,markers)
        



      
        

    </script>
    
    
  </body>

  